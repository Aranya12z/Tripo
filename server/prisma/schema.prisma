generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String

  trips     Trip[]
  tripMembers TripMember[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  @@index([createdAt])
  

}

model Trip {
  id        String   @id @default(uuid())
  title     String
  description String?
  budget    Float?
  userId    String

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  nodes     Node[]
  edges     Edge[]
  media     Media[]
  members   TripMember[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  @@index([userId])
  @@index([createdAt])
}

model TripMember {
  id      String @id @default(uuid())
  tripId  String
  userId  String
  role    String @default("viewer")

  trip    Trip   @relation(fields: [tripId], references: [id], onDelete: Cascade)
  user    User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([tripId])
  @@index([userId])
}

model Node {
  id        String  @id @default(uuid())
  title     String
  notes     String?
  latitude  Float?
  longitude Float?
  tripId    String

  trip      Trip    @relation(fields: [tripId], references: [id], onDelete: Cascade)
  edgesFrom Edge[]  @relation("FromNode")
  edgesTo   Edge[]  @relation("ToNode")
  media     Media[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  @@index([tripId])
  @@index([createdAt])
}

model Edge {
  id         String @id @default(uuid())
  tripId     String
  fromNodeId String
  toNodeId   String

  trip      Trip  @relation(fields: [tripId], references: [id], onDelete: Cascade)
  fromNode  Node  @relation("FromNode", fields: [fromNodeId], references: [id], onDelete: Cascade)
  toNode    Node  @relation("ToNode", fields: [toNodeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([tripId])
  @@index([fromNodeId])
  @@index([toNodeId])
}

model Media {
  id       String @id @default(uuid())
  url      String
  type     String
  nodeId   String?
  tripId   String

  node     Node?  @relation(fields: [nodeId], references: [id], onDelete: Cascade)
  trip     Trip   @relation(fields: [tripId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  deletedAt DateTime?

  @@index([tripId])
  @@index([nodeId])
}
